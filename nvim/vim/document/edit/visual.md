可视模式

[toc]

可视模式为操作符提供一片文本
> 它也是选择一个文本列块的唯一方法

# 使用可视模式

## 三个步骤

使用可视模式的三个步骤
1. 用 "v"、"V" 或 CTRL-V 标记文本的开始。
   当前光标下的字符将被作为标记的起始点。

2. 把光标移到要标记的文本末尾。
   起始点和光标之间的文本 (包括当前光标下的字符) 将被高亮显示。

3. 键入操作符命令。
   操作符命令将被应用到高亮显示的字符。



## 可视模式的一些设置

1. option 'hightlight'

    设置可视模式下的高亮显示方式

2. option 'virtualedit'

    设置是否允许光标停留在没有字符的位置。

3. option 'selection'

    通常高亮显示的文本包括当前光标下的字符。  
    若设置为"exclusive"，光标下的字符将不被包括。

> [!NOTE]
> 使用 "v" 命令，被高亮的文本将不包括起始点之前和结束点之后的字符。然而，所有的大写命令和非字母命令 ("~" 和 "U" 除外) 仍将作用在整行上


# 进入和退出可视模式

## 进入可视模式

### 普通进入

```lua
[count] v
```

- 进入可视模式，以字符为单位选择


```lua
[count] V
```
- 进入可视模式，以行为单位选择。


```lua
[count]CTRL-V
```
- 进入列块可视模式

> [!NOTE]
> 在 Windows 环境中，CTRL-V 可能被映射为粘贴操作，所以可能无法用来进入列块可视模式。参见CTRL-V-alternative 。


> [!NOTE]
> 说的是\[count]扩大上次选择的区域，但是我的好像不太行


## 特殊进入

```lua
gv
```

- 普通模式下：重新选择上一次的选择区和相同模式
- 可视模式下:该命令将交换当前和上一次选择区
- 可视模式下使用 "p" 或 "P" 后：选择刚刚粘贴的文本


```lua
gn/[N]
```

- 使用前次搜索模式正(反)向搜索，并启动可视模式来选中匹配。
    - 如果光标在匹配上，可视地选择
    - 如果有操作符等待，在匹配的目标上进行操作
    - 如果可视模式已激活，选择范围扩展到下(上)一个匹配处的尾部



> [!NOTE]
> 鼠标功能不了解，自信😼


## 退出可视模式

- 按\<ESC>
- 按击鼠标左键
- 按\<CTRL-Z>挂起
- 按\<CTRL-C>
- 跳转到另一个buffer
- 字符模式按\<v>，列块可视模式按\<CTRL-v>，行可视模式按\<V>

# 改变可视模式

## 模式切换

| 原有模式   | `v`       | `CTRL-V` | `V`       |
|------------|-----------|----------|-----------|
| 普通       | 可视      | 列块可视 | 行可视    |
| 可视       | 普通      | 列块可视 | 行可视    |
| 列块可视   | 可视      | 普通     | 行可视    |
| 行可视     | 可视      | 列块可视 | 普通      |


## 改变可视区域

```lua
o
```

- 跳到高亮文本的另一端(Other): 当前光标位置变成高亮文本的起点，光标移动到高亮文本的另一端
- 高亮区域保持不变。


```lua
O
```

- 跳到高亮文本的另一端。
- 同"o"命令相似，但是在列块模式下，光标移动到水平方向的另一个角
- 如果这个角上的字符占据了多个屏幕位置(例如一个\<Tab>)，那么高亮的文本区域会被改变。



## 扩大可视区域

| 命令  | 描述                             |
|-------|----------------------------------|
| h/j/k/l | 向不同反向扩大可视区域 |
| `a/iw`   | 一个单词 (包括空格) / 内含单词   |
| `a/iW`   | 一个字串 (包括空格) / 内含字串   |
| `a/is`   | 一个句子 (包括空格) / 内含句子   |
| `a/ip`   | 一个段落 (包括空格) / 内含段落   |
| `a/ib`   | 一个 () 块 (包括小括号) / 内含 () 块 |
| `a/iB`   | 一个 {} 块 (包括大括号) / 内含 {} 块 |
| `a/it`   | 一个 <tag> </tag> 块 (包含 tag) / 内含 <tag> </tag> 块 |
| `a/i<`   | 一个 <> 块 (包括 <>) / 内含 <> 块 |
| `a/i[`   | 一个 [] 块 (包括 []) / 内含 [] 块 |
| `a/i"`   | 一个双引号字符串 (包括引号) / 内含双引号字符串 |
| `a/i'`   | 一个单引号字符串 (包括引号) / 内含单引号字符串 |
| a/i` | 一个反引号字符串 (包括反引号) / 内含反引号字符串 |




# 操作可视区域

1. 对可视区域可以使用的操作符包括:

| 命令 | 描述          |
|------|---------------|
| `~`  | 切换大小写    |
| `d`  | 删除          |
| `c`  | 修改          |
| `y`  | 抽出          |
| `>`  | 右移          |
| `<`  | 左移          |
| `!`  | 通过外部命令过滤 |
| `=`  | 通过 `equalprg` 选项的命令过滤 |
| `gq` | 按照 `textwidth` 指定的宽度排版行 |


2. 其它可以使用的命令:

| 命令 | 描述                 |
|------|----------------------|
| `:`  | 为高亮的行启动 Ex 命令 |
| `r`  | 修改                 |
| `s`  | 修改                 |
| `C`  | 修改                 |
| `S`  | 修改                 |
| `R`  | 修改                 |
| `x`  | 删除                 |
| `D`  | 删除                 |
| `X`  | 删除                 |
| `Y`  | 抽出                 |
| `p`  | 放置                 |
| `P`  | 放置而不覆盖寄存器     |
| `J`  | 连接                 |
| `U`  | 变成大写             |
| `u`  | 变成小写             |
| `^]` | 查找标签             |
| `I`  | 列块插入             |
| `A`  | 列块添加             |


- 如果你想用 """ 命令指定一个寄存器，只须将寄存器命令加在操作符之前
- 如果你想给命令加上计数，只须将数字加在操作符之前


## 列块模式操作

对一个列块可视模式下的选择区

1. 列块插入 

```lua
I{string}<ESC>
```
- 从选择区开始的位置在每一行插入字符串 {string}。
- 只有那些和选择区有交集的行才会被插入，因此过短的行将不受影响。
- 如果选择区包含制表符，制表符将会被分开，以维持选择区的可视列不变
    > 制表符会被分解为等价的空格
- 只适用于给每一行增加文本，而不是删除



2. 列块添加
```lua
A{string}<ESC> 
```

- 从选择区结束处开始在每一行插入字符串 {string}。
    - 如果列块是用 <C-v>$ 命令产生的: 字符串被附加到每一行的结尾。
    - 如果列块是用 <C-v>{motions}命令产生的: 字符串将被附加到每一行列块的结尾，短行以空白填充
- 只适用于给每一行增加文本，而不是删除


3. 列块修改
```lua
c
```

- 选择区的所有文本将被相同的字符串代替
- 当使用 "c" 命令的时候选择区的文本将被删除，然后进入插入模式。这时候你可以键入不带回车的文本
- 当你按\<Esc>的时候所键入的文本将被插入选择区的每一行。
- `C`类似，但是会将选择区扩展到每一行的结尾


4. 列块平移

```lua
>/<
```
- 列块按照 'shiftwidth' 指定的单位移动。
- 块的左边界决定了从哪一点开始右移，与块的右边界无关
- 块的左边界决定了左移的终止点。

4. 列块替换

```lua
r
```
- 高亮区域的每个字符被同一个字符代替
- 制表符将被分割，虚拟空白字符也将被替换



# 重复对可视模式的操作

当重复一个可视模式操作时，该操作将被应用到与上次操作相同数量的文本上:
- 行可视模式: 相同数量的行。
- 列块可视模式: 相同数量的行和列。
- 选择区在一行之内的普通可视模式: 相同数量的字符。
- 跨越多行的普通可视模式: 相同数量的行，最后一行的字符数与上次相同。重复操作的起始点在当前光标位置。如果重复的命令中包含 "$" 命令来扩展选择区，那么重复操作将应用到最长行的最右一列。不使用传递给  .  命令的计数。


> [!NOTE]
> 相同数量的行，列或字符都是相对于光标当前位置开始的





# 选择模式

选择模式看起来与可视模式非常相似，但是在选择模式所接受的命令与可视模式有很大不同。它类似于 Microsoft Windows 上的选择模式。如果 'showmode' 选项打开，处于选择模式的时候在屏幕底端会显示 "-- 选择 --"


## 进入选择模式的几种方法

- 在可视模式，键入 CTRL-G。  

```lua
gh
```
- 启动字符方式的选择模式。


```lua
gH
```
-  启动按行选择的选择模式。

```lua
g <CTRL-H>
```
-  启动列块方式的选择模式。


## 可视模式的命令

- 所有可显示字符、\<NL>和\<CR> 将删除当前的选择区，然后进入插入模式。插入键入的字符。
- \<ESC>退出选择模式
- CTRL-O 临时切换到可视模式执行一个命令。
- CTRL-G 切换到可视模式。
- CTRL-R {register} 选择键入文本时文本被删除的寄存器。


### gV

当一个对选择(可视)模式下的目标文本的键盘映射或菜单命令被执行完毕后，退出对可视区域的选择，即退回普通模式

作用：
- 把gV放在键盘映射或菜单命令的结尾即可
- 或者至少应该在任何对选择区操作的命令之后。



