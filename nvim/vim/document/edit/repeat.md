重复命令，Vim脚本和调试

# 单次重复

```lua
.
```
- 重复上次简单的改变操作
- 如果没有[count]，使用上次的改变的重复次数
- 如果有[count]，就用它取代上次的计数

> [!NOTE]
> 如果 'cpoptions' 包括 'y' 标志， 也可以用来重复一个抽出 (yank) 操作


- 不能重复命令行命令
- 如果上次改变的操作使用数字编号的寄存器，则逐次递增使用寄存器的序号
- 如果重复的命令涉及可视的选择区域，使用相同大小的区域


```lua
@:
```
- 重复上次命令行[count]次
- 仅当编译时加入'+cmdline_hist'特性才可用



# 多次重复


## glob命令

```lua
:[range]g[lobal]/{pattern}/[cmd]
```

- 在[range]界定的匹配模式 {pattern} 的文本行上执行Ex命令[cmd] (缺省是 ":p"，打印到消息输出)。


```lua
:[range]g[lobal]!/{pattern}/[cmd]

:[range]v[global]/{pattern}/[cmd]
```
- 在[range]界定的不匹配模式{pattern}的文本行上执行Ex命令[cmd] (缺省是 ":p")



## global流程

1. global 命令先扫描 [range] 界定的行，然后对每个匹配的行进行标记 (对于一个跨行的匹配，则只针对开始的一行)。

2. 第二次扫描对每个标记的行，就像光标在那行那样，执行指定的 [cmd] 命令。


## 注意

- ":v" 和":g!" 命令针对未标记的行进行。如果一行被删除，其标记也自动消失。
- 缺省的[range]是整个缓冲区 (1,$)。
- cmd可使用任何 Ex 命令
- 用 "CTRL-C" 中断该命令。如果某行的执行给出错误，该行的执行被中断，但global命令仍从下一个被标记或未被标记的行继续。


## cmd递归重复

```lua
:g/.../g/.../cmd
```
- 此时第二个`g/.../cmd`是第一个`g/.../cmd`的`cmd`部分
- 命令递归使用时，只能作用于一行
- 此时不能给出范围
- 可用于找到所有匹配某模式，但不匹配另一模式的行



# 重复组合操作

```lua
q{0-1a-zA-Z"}
```
- 在寄存器 {0-9a-zA-Z"} 里记录键入的字符 
- 大写名字的寄存器表示附加键入的内容


```lua
q
```
- 停止记录


```lua
@{0-9a-z".=*+"}
```
- 执行寄存器 {0-9a-z".=*+} 的内容[count]次


```lua
:[addr]@{0-9a-z".=*+"}
```
- 把寄存器 {0-9a-z".=*+} 里的内容看成一个 Ex 命令执行
- 首先，把光标放在 [addr] 行 (缺省是当前行) 上
- 然后，会对地址范围里每一行执行寄存器的命令

```lua
:[addr]@:
```
-  先把光标放在 [addr] 行 (缺省是当前行) 上，然后重复上次的命令行。

```lua
:[addr]@
:[addr]@@
```
- 先把光标放在 [addr] 行 (缺省是当前行) 上，然后重复上次的 :@{register}。

# vim脚本

## 使用vim脚本

## 使用vim脚本包

## 创建vim脚本包

## 调试脚本

## 刨视

